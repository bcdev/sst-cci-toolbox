#!/bin/bash

# fetch changes from github and install
currentdir=`pwd`
cd ${mms_github}
${mms.git.exec} pull
${mms.mvn.exec} clean package install
cd ${currentdir}

#commithash=`git log --abbrev-commit -1 --pretty=%H`
#commithash=`git log --abbrev-commit -1 --pretty=%h`

# build new software version
${mms.mvn.exec} -f ${mms_github}/mms/pom.xml package assembly:assembly

# remove previous software version
echo removing software in ${mms_home}
rm -rf ${mms_home}

# copy assembly to target directory
echo copying assembly to $(dirname ${mms_home})
cp -R ${mms_github}/target/sst-cci-mms-${project_version}-bin/sst-cci-mms-${project_version} $(dirname ${mms_home})

# change file permissions manually because maven assembly does not do this
echo changing file permissions
chmod -R ug+X ${mms_home}
